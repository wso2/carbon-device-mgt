{{!
  Copyright (c) 2016, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.

  WSO2 Inc. licenses this file to you under the Apache License,
  Version 2.0 (the "License"); you may not use this file except
  in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing,
  software distributed under the License is distributed on an
  "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, either express or implied. See the License for the
  specific language governing permissions and limitations
  under the License.
}}
{{unit "cdmf.unit.ui.title" pageTitle="Policy Management"}}
{{unit "cdmf.unit.data-tables-extended"}}
{{unit "cdmf.unit.ui.modal"}}

{{#zone "topCss"}}
  {{css "css/policies_custom.css"}}
    <style>
        .thumbnail.icon:before {
            padding-top: 0;
        }
    </style>
{{/zone}}

{{#zone "breadcrumbs"}}
    <button class="searchToggleButton" id="searchToggleBtn"
     {{!--data-toggle="collapse" data-target="#searchBox, #policy-grid_filter"--}}
     >
        <i class="icon fw fw-filter" ></i>
    </button>
    <li>
        <a href="{{@app.context}}/">
            {{!--<i class="icon fw fw-home"></i>--}}
            Home
        </a>
    </li>
    <li>
        <!--suppress HtmlUnknownTarget -->
        <a href="{{@app.context}}/policies">
            Policies
        </a>
    </li>
{{/zone}}

{{#zone "navbarActions"}}
    {{#if permissions.ADD_ADMIN_POLICY}}
        {{#equal noPolicy false}}
            <li>
                <!--suppress HtmlUnknownTarget -->
                <a href="{{@app.context}}/policy/add" class="cu-btn">
                    <span class="icon fw-stack">
                        <i class="fw fw-add fw-stack-1x"></i>
                        <i class="fw fw-circle-outline fw-stack-2x"></i>
                    </span>
                    + Add
                </a>
            </li>
        {{/equal}}
    {{/if}}
    {{#if permissions.CHANGE_POLICY_PRIORITY}}
        {{#equal noPolicy false}}
            <li>
                <!--suppress HtmlUnknownTarget -->
                <a href="{{@app.context}}/policy/priority" class="cu-btn">
                    <span class="icon fw-stack">
                        <i class="fw fw-throttling-policy fw-stack-1x"></i>
                        <i class="fw fw-circle-outline fw-stack-2x"></i>
                    </span>
                    Policy Priority
                </a>
            </li>
        {{/equal}}
    {{/if}}
    <li>
        <a href="#" class="cu-btn" id="appbar-btn-apply-changes">
            <span class="icon fw-stack">
                <i class="fw fw-check fw-stack-1x"></i>
                <i class="fw fw-circle-outline fw-stack-2x"></i>
            </span>
            Apply Changes
        </a>
    </li>
{{/zone}}

{{#zone "content"}}
    {{#equal isUpdated true}}
        <input type="hidden" id="is-updated" value="UPDATED">
    {{/equal}}
    <div class="submenu detail_sub_headings">
                <ul>
                    <li><a class="active" href="{{@app.context}}/policies">Policies</a></li>    

                </ul>   
    </div>  
    {{#equal noPolicy true}}
    <style>
        .actionSec{
            display:none;
        }
        #_uuf-navbar{
            margin-left: 170px;
        }
         .page-content-wrapper{
            margin:0px;
        }
        #ast-container{
        height: 80%;
        margin: 30px auto;
        background-color: white;
        }
    </style>
        <div id="ast-container" class="ast-container list-view">
            <div class="ctrl-info-panel text-center wr-login">
                 <div class="empty_table">
                <h3 class="text-muted">
                    Error
                </h3>
                <h4 class="text-muted">You don't have any device policies. Let's add a new policy!</h4>
                </div>
                {{#if permissions.ADD_ADMIN_POLICY}}
               
                    <h3>
                        <!--suppress HtmlUnknownTarget -->
                        <a href="{{@app.context}}/policy/add" class="btn-operations btn-default">
                            
                            + Add
                        </a>
                    </h3>
                {{/if}}
            </div>
        </div>
    {{/equal}}
    {{#equal noPolicy false}}
        <div id="loading-content" class="col-centered">
            <i class="fw fw-settings fw-spin fw-2x"></i>
            Loading policies . . .
            <br>
        </div>
        <table class="table table-striped table-hover list-table display grid-view responsive nowrap data-table hidden"
               id="policy-grid">
            <thead>
            <tr class="sort-row">
                <th class="no-sort"></th>
                <th class="no-sort"></th>
                <th>By Platform</th>
                <th>By Ownership Type</th>
                <th>By Role</th>
                <th>By User</th>
                <th>By Compliance Type</th>
                <th>By Status</th>
                <th class="no-sort"></th>
            </tr>
            <tr class="filter-row filter-box"  id="searchBox">
                <th class="no-sort"></th>
                <th class="no-sort"></th>
                <th data-for="Platform" class="select-filter"></th>
                <th data-for="By Ownership Type" class="hidden select-filter"></th>
                <th data-for="By Role" class="hidden text-filter"></th>
                <th data-for="By User" class="hidden text-filter"></th>
                <th data-for="Compliance Type" class="select-filter"></th>
                <th data-for="Status" class="select-filter"></th>
                <th class="no-sort"></th>
            </tr>
            
            </thead>
            <thead class="heading-row">
                <tr>
                    <th colspan=20% class="table-heading tableHeading">Name</th> 
                    <th colspan=20% class="table-heading tableHeading">Status</th> 
                    <th colspan=20% class="table-heading tableHeading">Role(s)</th> 
                    <th colspan=20% class="table-heading tableHeading">User(s)</th> 
                    <th colspan=20% class="table-heading tableHeading">Compliance Type</th> 
                </tr>
            </thead>

            <tbody id="policyListContainer" class="commonTabelListing">
            {{#each policyListToView}}
                <tr data-type="selectable" data-id="{{id}}" data-status="{{status}}">
                
                    <td class="remove-padding icon-only content-fill viewEnabledIcon"
                         data-id="{{id}}"             
                        data-search="{{name}}"
                        data-display="{{name}}"
                        data-url="{{@app.context}}/policy/view?id={{id}}&deviceType={{platform}}">
                        <h4 class="policyName">{{name}}</h4>
                        
                    </td>
                    <td>
                        {{#equal status "Active/Updated"}}
                            <span><i class="fw fw-warning icon-success"></i> Active/Updated</span>
                        {{/equal}}
                        {{#equal status "Active"}}
                            <span><i class="fw fw-success icon-success"></i> Active</span>
                        {{/equal}}
                        {{#equal status "Inactive/Updated"}}
                            <span><i class="fw fw-warning icon-warning"></i> Inactive/Updated</span>
                        {{/equal}}
                        {{#equal status "Inactive"}}
                            <span><i class="fw fw-error icon-danger"></i> Inactive</span>
                        {{/equal}}
                    </td>
                    <td class="remove-padding-top platform"
                        data-search="{{platform}}"
                        data-display="{{platform}}">
                    </td>
                    <td class="remove-padding-top ownership"
                        data-search="{{ownershipType}}"
                        data-display="{{ownershipType}}"
                        >
                        <span>
                        {{ownershipType}}
                        </span>
                    </td>
                    <td id="policy-roles" class="remove-padding-top"
                        data-search="{{roles}}"
                        data-display="{{roles}}"
                        >
                        <span>
                        {{roles}}
                        </span>
                    </td>
                    <td id="policy-users" class="remove-padding-top"
                        data-search="{{users}}"
                        data-display="{{users}}"
                        >
                        <span>
                        {{users}}
                        </span>
                    </td>
                    <td class="remove-padding-top"
                        data-search="{{compliance}}"
                        data-display="{{compliance}}"
                        >
                        <span>
                        {{compliance}}
                        </span>
                    </td>
                    <td id="policy-status" class="remove-padding-top"
                        data-search="{{status}}"
                        data-display="{{status}}">
                    </td>
                    <td class="text-right content-fill text-left-on-grid-view no-wrap">
                        <!--suppress HtmlUnknownTarget -->
                        <a href="{{@app.context}}/policy/edit?id={{id}}&deviceType={{platform}}"
                           data-id="{{id}}"
                           data-click-event="remove-form"
                           class="btn padding-reduce-on-grid-view policy-update-link">
                                <span class="fw-stack">
                                    <i class="fw fw-circle-outline fw-stack-2x"></i>
                                    <i class="fw fw-edit fw-stack-1x"></i>
                                </span>
                            {{!--<span class="hidden-xs hidden-on-grid-view">Re-Configure</span>--}}
                        </a>
                    </td>
                </tr>
            {{/each}}
           
            </tbody>
        </table>
    {{/equal}}
   

    <div id="content-filter-types" style="display: none">
        <div class="sort-title">Sort By</div>
        <div class="sort-options">
            <a href="#">By Platform<span class="ico-sort-asc"></span></a>
            <a href="#">By Ownership Type</a>
            <a href="#">By Role</a>
            <a href="#">By User</a>
            <a href="#">By Compliance Type</a>
            <a href="#">By Status</a>
        </div>
    </div>
{{/zone}}


{{#zone "actionBar"}}
<tr class="bulk-action-row">
                <th colspan="9">
                    <ul class="tiles">
                        {{#if removePermitted}}
                            <li class="square">
                                <a href="#" data-click-event="remove-form" class="btn square-element policy-remove-link"
                                   data-toggle="modal" data-target="#modalDemo">
                                            <span class="icon fw-stack">
                                                <i class="fw fw-circle-outline fw-stack-2x"></i>
                                                <i class="fw fw-delete fw-stack-1x"></i>
                                            </span>
                                    Delete
                                </a>
                            </li>
                        {{/if}}
                        <li class="square">
                            <a href="#" data-click-event="remove-form" class="btn square-element policy-publish-link"
                               data-toggle="modal" data-target="#modalDemo">
                                        <span class="icon fw-stack">
                                            <i class="fw fw-circle-outline fw-stack-2x"></i>
                                            <i class="glyphicon glyphicon-floppy-saved"></i>
                                        </span>
                                Publish
                            </a>
                        </li>
                        <li class="square">
                            <a href="#" data-click-event="remove-form" class="btn square-element policy-unpublish-link"
                               data-toggle="modal" data-target="#modalDemo">
                                        <span class="icon fw-stack">
                                            <i class="fw fw-circle-outline fw-stack-2x"></i>
                                            <i class="glyphicon glyphicon-floppy-remove"></i>
                                        </span>
                                Unpublish
                            </a>
                        </li>
                    </ul>
                </th>
            </tr>

{{/zone}}

{{#zone "bottomJs"}}
    {{js "js/policy-list.js"}}
    <script>
        function gotoPolicyList(link){
            alert(event.target);
            var sender = event.target;
            if ( $(event.target).closest( "ul" ).hasClass( "DTTT_selected" ) ) {
                console.log(event.target);
            }
            else{
                window.location.href = link;
            }
        };

        
    </script>
{{/zone}}